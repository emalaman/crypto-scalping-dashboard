<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crypto Scalping Dashboard - 15min Charts</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
  <style>
    body { background: #0a0a0a; color: #e5e5e5; font-family: 'Inter', sans-serif; }
    .card { background: #121212; border: 1px solid #333; border-radius: 0.5rem; transition: all .2s; }
    .card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,.3); border-color: #1565c0; }
    .badge { font-size: .75rem; padding: .25rem .5rem; border-radius: 4px; font-weight: 600; border: 1px solid; }
    .badge-BUY { background: rgba(34, 197, 94, 0.2); color: #22c55e; border-color: #22c55e; }
    .badge-STRONG_BUY { background: rgba(34, 197, 94, 0.3); color: #4ade80; border-color: #4ade80; }
    .badge-SELL { background: rgba(239, 68, 68, 0.2); color: #ef4444; border-color: #ef4444; }
    .badge-STRONG_SELL { background: rgba(239, 68, 68, 0.3); color: #f87171; border-color: #f87171; }
    .badge-NEUTRAL { background: rgba(156, 163, 175, 0.2); color: #9ca3af; border-color: #9ca3af; }
    .chart-container { height: 200px; width: 100%; background: #1a1a1a; border-radius: 0.25rem; overflow: hidden; }
    .text-green { color: #22c55e; }
    .text-red { color: #ef4444; }
    .grid { display: grid; gap: 1rem; }
    .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
    .lg-grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    .p-3 { padding: 0.75rem; }
    .p-4 { padding: 1rem; }
    .mb-2 { margin-bottom: 0.5rem; }
    .mb-4 { margin-bottom: 1rem; }
    .text-sm { font-size: 0.875rem; }
    .text-xs { font-size: 0.75rem; }
    .text-lg { font-size: 1.125rem; }
    .font-bold { font-weight: 700; }
    .font-semibold { font-weight: 600; }
    .text-gray-400 { color: #9ca3af; }
    .text-gray-500 { color: #6b7280; }
    .flex { display: flex; }
    .justify-between { justify-content: space-between; }
    .items-center { align-items: center; }
    .gap-2 { gap: 0.5rem; }
    .gap-4 { gap: 1rem; }
    .min-h-screen { min-height: 100vh; }
    .max-w-6xl { max-width: 72rem; }
    .mx-auto { margin-left: auto; margin-right: auto; }
    .px-4 { padding-left: 1rem; padding-right: 1rem; }
    .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
    .mt-12 { margin-top: 3rem; }
    .text-center { text-align: center; }
  </style>
</head>
<body class="min-h-screen bg-dark-900">
  <div class="max-w-6xl mx-auto px-4 py-8">
    <header class="mb-10 text-center">
      <h1 class="text-4xl font-bold text-white border-b-2 border-primary-700 pb-2 inline-block">ðŸš€ Crypto Scalping Dashboard</h1>
      <p class="text-gray-400 text-lg mt-2">
        Top <span id="total-count" class="text-white font-semibold">0</span> crypto opportunities Â· Spread 1.5%-50% Â· Vol > $10k Â· 15min charts
        <br>Last updated: <span id="last-update" class="text-primary-400 font-mono"></span>
      </p>
      <button onclick="location.reload()" class="mt-4 px-4 py-2 bg-primary-900/50 border border-primary-600 rounded hover:bg-primary-800/50 text-primary-200">ðŸ”„ Refresh</button>
    </header>

    <div class="flex justify-center mb-8 flex-wrap gap-4 items-center">
      <div class="flex items-center gap-2">
        <label class="text-gray-300">Signal:</label>
        <select id="signal-filter" onchange="applyFilters()" class="px-4 py-2 bg-dark-800 border border-gray-700 rounded text-white">
          <option value="All">All Signals</option>
          <option value="STRONG_BUY">STRONG_BUY</option>
          <option value="BUY">BUY</option>
          <option value="NEUTRAL">NEUTRAL</option>
          <option value="SELL">SELL</option>
          <option value="STRONG_SELL">STRONG_SELL</option>
        </select>
      </div>
      <div class="flex items-center gap-2">
        <label class="text-gray-300">Max Spread:</label>
        <select id="spread-filter" onchange="applyFilters()" class="px-4 py-2 bg-dark-800 border border-gray-700 rounded text-white">
          <option value="All">All</option>
          <option value="2">â‰¤ 2%</option>
          <option value="3">â‰¤ 3%</option>
          <option value="5">â‰¤ 5%</option>
          <option value="10">â‰¤ 10%</option>
        </select>
      </div>
      <div class="flex items-center gap-2">
        <label class="text-gray-300">History:</label>
        <select id="history-filter" onchange="applyFilters()" class="px-4 py-2 bg-dark-800 border border-gray-700 rounded text-white">
          <option value="all">All</option>
          <option value="24h">Last 24h</option>
          <option value="12h">Last 12h</option>
          <option value="6h">Last 6h</option>
        </select>
      </div>
    </div>

    <div id="stats" class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8"></div>

    <div id="grid" class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8"></div>

    <footer class="text-center py-8 text-gray-500 text-sm border-t border-gray-800 mt-12">
      <p>Polymarket Gamma API Â· 15min price history charts Â· Auto-refresh every 15min</p>
    </footer>
  </div>

  <script>
    const rawData = [{"id":"540844","question":"Will bitcoin hit $1m before GTA VI?","category":"Crypto","yes":0.485,"no":0.515,"yesSpread":0.015000000000000013,"noSpread":0.015000000000000013,"maxSpread":0.015000000000000013,"underpricedSide":"YES","underpricedPrice":0.485,"signal":"BUY","volume":3081013.327868,"liquidity":158714.8422,"updatedAt":"2026-02-11T16:04:36.959404Z","timeLeft":14629758775,"marketUrl":"https://polymarket.com/event/what-will-happen-before-gta-vi/will-bitcoin-hit-1m-before-gta-vi-872","cryptoSymbol":"BTCUSDT","history":[{"t":1770825876,"yes":0.485,"no":0.515,"v":3081013.327868}],"historyPoints":1}];
    const opportunities = rawData;

    let currentPage = 1, currentSignal = 'All', currentSpreadFilter = 'All', currentHistoryFilter = 'all';
    const PAGE_SIZE = 12;

    function formatNumber(n) {
      if (n >= 1000000) return (n/1000000).toFixed(1) + 'M';
      if (n >= 1000) return (n/1000).toFixed(1) + 'k';
      return n.toFixed(0);
    }

    function formatPrice(p) {
      return p < 1 ? p.toFixed(3) : p.toFixed(2);
    }

    function formatTime(seconds) {
      const date = new Date(seconds * 1000);
      return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false });
    }

    function renderStats(filtered) {
      const stats = document.getElementById('stats');
      const avgSpread = (filtered.reduce((sum, o) => sum + o.maxSpread, 0) / filtered.length * 100).toFixed(1);
      const totalVol = filtered.reduce((sum, o) => sum + o.volume, 0);
      const withHistory = filtered.filter(o => o.history && o.history.length > 0).length;

      stats.innerHTML = `
        <div class="card p-4 text-center">
          <div class="text-gray-400 text-xs uppercase">Opportunities</div>
          <div class="text-2xl font-bold text-white">${filtered.length}</div>
        </div>
        <div class="card p-4 text-center">
          <div class="text-gray-400 text-xs uppercase">Avg Spread</div>
          <div class="text-2xl font-bold ${avgSpread < 3 ? 'text-green' : avgSpread < 10 ? 'text-orange-400' : 'text-red'}">${avgSpread}%</div>
        </div>
        <div class="card p-4 text-center">
          <div class="text-gray-400 text-xs uppercase">Total Volume</div>
          <div class="text-2xl font-bold text-white">$${formatNumber(totalVol)}</div>
        </div>
        <div class="card p-4 text-center">
          <div class="text-gray-400 text-xs uppercase">With 15min History</div>
          <div class="text-2xl font-bold text-blue-400">${withHistory}</div>
        </div>
      `;
    }

    function renderChart(container, history) {
      if (!history || history.length === 0) {
        container.innerHTML = '<div class="flex items-center justify-center h-full text-gray-500 text-sm">No historical data yet</div>';
        return;
      }

      // Filter by time if needed
      let data = history;
      if (currentHistoryFilter !== 'all') {
        const now = Math.floor(Date.now() / 1000);
        const cutoff = {
          '24h': 24 * 60 * 60,
          '12h': 12 * 60 * 60,
          '6h': 6 * 60 * 60
        }[currentHistoryFilter];
        data = history.filter(point => now - point.t <= cutoff);
      }

      if (data.length === 0) {
        container.innerHTML = '<div class="flex items-center justify-center h-full text-gray-500 text-sm">No data in selected timeframe</div>';
        return;
      }

      // Sort by time
      data.sort((a, b) => a.t - b.t);

      const chartData = data.map(point => ({
        time: point.t,
        value: point.yes
      }));

      const chart = LightweightCharts.createChart(container, {
        width: container.clientWidth,
        height: 200,
        layout: {
          background: { type: 'solid', color: '#1a1a1a' },
          textColor: '#9ca3af',
        },
        grid: {
          vertLines: { color: '#2a2a2a' },
          horzLines: { color: '#2a2a2a' },
        },
        crosshair: {
          mode: 1,
        },
        rightPriceScale: {
          borderColor: '#333',
        },
        timeScale: {
          borderColor: '#333',
          timeVisible: true,
          secondsVisible: false,
        },
      });

      const lineSeries = chart.addLineSeries({
        color: '#22c55e',
        lineWidth: 2,
        title: 'YES Price'
      });

      lineSeries.setData(chartData);
    }

    function createOpportunityCard(o) {
      const hasHistory = o.history && o.history.length > 0;
      const chartId = `chart-${o.id}`;

      // Calculate price change if we have history
      let priceChange = '';
      let priceChangeClass = '';
      if (hasHistory && o.history.length >= 2) {
        const latest = o.history[o.history.length - 1].yes;
        const previous = o.history[o.history.length - 2].yes;
        const change = ((latest - previous) / previous * 100).toFixed(2);
        priceChange = `(${change >= 0 ? '+' : ''}${change}%)`;
        priceChangeClass = change >= 0 ? 'text-green' : 'text-red';
      }

      // History timeframe
      const historyPoints = o.historyPoints || 0;
      const startTime = hasHistory ? o.history[0].t : null;
      const endTime = hasHistory ? o.history[o.history.length - 1].t : null;
      const duration = startTime && endTime ? Math.floor((endTime - startTime) / 3600) : 0;

      return `
        <div class="card p-4" data-category="Crypto" data-signal="${o.signal}" data-spread="${Math.round(o.maxSpread*100)}">
          <div class="flex justify-between items-start mb-2">
            <h3 class="text-lg font-bold text-white line-clamp-2">${o.question}</h3>
            <span class="badge badge-${o.signal.replace(/_/g, '_')}">${o.signal}</span>
          </div>
          <div class="text-xs text-gray-400 mb-2 flex gap-4">
            <span>Symbol: <span class="text-white font-mono">${o.cryptoSymbol || 'N/A'}</span></span>
            <span>Ends: ${Math.floor(o.timeLeft/(1000*60*60*24))}d</span>
            <span>History: ${historyPoints} points (${duration}h)</span>
          </div>
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div>
              <div class="text-xs text-gray-400">YES / NO</div>
              <div class="flex gap-2 items-center">
                <span class="text-lg font-bold ${o.underpricedSide === 'YES' ? 'text-green' : ''}">${formatPrice(o.yes)}</span>
                <span class="text-gray-500">/</span>
                <span class="text-lg font-bold ${o.underpricedSide === 'NO' ? 'text-red' : ''}">${formatPrice(o.no)}</span>
              </div>
              <div class="text-xs text-gray-500">Spread: <span class="${o.maxSpread < 0.03 ? 'text-green' : o.maxSpread < 0.1 ? 'text-orange-400' : 'text-red'}">${(o.maxSpread*100).toFixed(2)}%</span> ${priceChange}</div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Volume / Liquidity</div>
              <div class="text-sm font-bold text-white">$${formatNumber(o.volume)}</div>
              <div class="text-xs text-gray-500">Liq: $${formatNumber(o.liquidity)}</div>
            </div>
          </div>
          ${hasHistory ? `<div id="${chartId}" class="chart-container mb-4"></div>` : ''}
          <div class="flex justify-between items-center">
            <span class="text-xs text-gray-400">${new Date(o.updatedAt).toLocaleString()}</span>
            <a href="${o.marketUrl}" target="_blank" class="px-3 py-1 bg-primary-600 hover:bg-primary-700 text-white text-sm rounded transition">View on Polymarket</a>
          </div>
        </div>
      `;
    }

    function applyFilters() {
      currentSignal = document.getElementById('signal-filter').value;
      currentSpreadFilter = document.getElementById('spread-filter').value;
      currentHistoryFilter = document.getElementById('history-filter').value;
      currentPage = 1;
      render();
    }

    function render() {
      let filtered = opportunities;

      if (currentSignal !== 'All') {
        filtered = filtered.filter(o => o.signal === currentSignal);
      }

      if (currentSpreadFilter !== 'All') {
        const maxSpread = parseFloat(currentSpreadFilter) / 100;
        filtered = filtered.filter(o => o.maxSpread <= maxSpread);
      }

      // History filter: require minimum history points
      if (currentHistoryFilter !== 'all') {
        const minHours = {
          '24h': 24,
          '12h': 12,
          '6h': 6
        }[currentHistoryFilter];
        filtered = filtered.filter(o => {
          if (!o.history || o.history.length < 2) return false;
          const start = o.history[0].t;
          const end = o.history[o.history.length - 1].t;
          const hours = (end - start) / 3600;
          return hours >= minHours;
        });
      }

      const totalPages = Math.ceil(filtered.length / PAGE_SIZE);
      const start = (currentPage - 1) * PAGE_SIZE;
      const pageData = filtered.slice(start, start + PAGE_SIZE);

      document.getElementById('total-count').textContent = filtered.length;
      document.getElementById('last-update').textContent = new Date().toLocaleTimeString();

      renderStats(filtered);

      const grid = document.getElementById('grid');
      grid.innerHTML = pageData.map(o => createOpportunityCard(o)).join('');

      // Render charts after DOM update
      setTimeout(() => {
        pageData.forEach(o => {
          if (o.history) {
            const container = document.getElementById(`chart-${o.id}`);
            if (container) renderChart(container, o.history);
          }
        });
      }, 100);

      // Pagination
      const paginationTop = document.getElementById('pagination-top');
      const paginationBottom = document.getElementById('pagination-bottom');
      let paginationHtml = '';

      if (totalPages > 1) {
        let pages = [];
        if (totalPages <= 7) {
          pages = Array.from({ length: totalPages }, (_, i) => i + 1);
        } else {
          if (currentPage <= 3) pages = [1, 2, 3, 4, 5, '...', totalPages];
          else if (currentPage >= totalPages - 2) pages = [1, '...', totalPages - 4, totalPages - 3, totalPages - 2, totalPages - 1, totalPages];
          else pages = [1, '...', currentPage - 1, currentPage, currentPage + 1, '...', totalPages];
        }

        paginationHtml = pages.map(p => {
          if (p === '...') return `<span class="px-2 text-gray-500">...</span>`;
          return `
            <button class="pagination-btn ${p === currentPage ? 'active' : ''}" onclick="goToPage(${p})">${p}</button>
          `;
        }).join('');
      }

      const pagHtml = `<div class="flex justify-center gap-2">${paginationHtml}</div>`;
      paginationTop.innerHTML = pagHtml;
      paginationBottom.innerHTML = pagHtml;
    }

    function goToPage(page) {
      currentPage = page;
      render();
    }

    render();

    // Responsive
    window.addEventListener('resize', () => {
      render();
    });
  </script>
</body>
</html>
